# 天气API集成测试

## 概述

应用现在集成了 OpenWeatherMap 的真实天气API，提供全球城市的实时天气数据。

## 配置步骤

### 1. 获取API Key

1. 访问 [OpenWeatherMap](https://openweathermap.org/api)
2. 注册免费账户
3. 在账户设置中获取API Key

### 2. 配置环境变量

在 `.env.local` 文件中添加：

```env
OPENWEATHERMAP_API_KEY=你的API密钥
```

### 3. 重启应用

```bash
pnpm dev
```

## 测试用例

### 基本天气查询

**测试命令**：

```
今天北京天气怎么样？
```

**预期结果**：

- 显示北京的实时温度、天气状况、湿度、风速
- 数据来自OpenWeatherMap API

### 不同城市测试

**测试城市**：

- 北京 (Beijing)
- 上海 (Shanghai)
- 深圳 (Shenzhen)
- 纽约 (New York)
- 伦敦 (London)
- 东京 (Tokyo)

### 温度单位测试

**测试命令**：

```
洛杉矶的天气，温度用华氏度显示
```

**预期结果**：

- 温度显示为°F单位
- 其他数据正常显示

## API特性

### 免费层级

- **1000次/天** - 完全免费
- **支持全球城市** - 覆盖200+国家
- **实时数据** - 每小时更新
- **中文支持** - 天气描述为中文

### 数据字段

- 城市名称
- 当前温度
- 天气状况（晴朗、多云、雨等）
- 相对湿度
- 风速
- 温度单位（°C/°F）

## 降级策略

### 未配置API Key

- 自动使用模拟数据
- 支持北京、上海、深圳等主要城市
- 控制台显示提示信息

### API调用失败

- 自动降级到模拟数据
- 控制台记录错误信息
- 用户体验不受影响

## 错误处理

### 城市不存在

```
错误：城市 "不存在的城市" 未找到
```

### API配额超限

```
错误：API调用次数超限，请稍后再试
```

### 网络错误

```
错误：获取天气数据失败，使用模拟数据
```

## 性能优化

- **缓存机制**：相同城市的重复查询会复用结果
- **错误重试**：API调用失败时自动重试一次
- **超时控制**：API调用超时时间为10秒
- **并发限制**：避免过多并发请求

## 监控和调试

### 控制台日志

- API调用成功：显示获取的城市和温度
- API调用失败：显示错误原因和降级信息
- 未配置API Key：显示使用模拟数据的提示

### 调试模式

设置环境变量 `DEBUG=weather` 可启用详细日志：

```env
DEBUG=weather
```

## 兼容性

- ✅ 桌面端 Chrome/Firefox/Safari
- ✅ 移动端 iOS Safari/Android Chrome
- ✅ 支持HTTP/HTTPS
- ✅ 支持IPv4/IPv6

## 故障排除

### 问题：API Key无效

**解决方案**：

1. 检查API Key是否正确
2. 确认账户是否激活
3. 查看API Key是否有调用限制

### 问题：城市名称无法识别

**解决方案**：

- 使用中文城市名："北京"、"上海"
- 使用英文城市名："Beijing"、"Shanghai"
- 包含省份信息："北京市"、"上海市"

### 问题：总是显示模拟数据

**解决方案**：

1. 检查 `.env.local` 文件是否存在
2. 确认环境变量名称正确
3. 重启开发服务器
4. 检查控制台是否有配置提示

## 扩展计划

### 未来功能

- [ ] 天气预报（未来5天）
- [ ] 空气质量数据
- [ ] 紫外线指数
- [ ] 其他天气API集成（WeatherAPI、AccuWeather）

### 企业级功能

- [ ] API调用统计
- [ ] 缓存优化
- [ ] 批量查询
- [ ] 地理编码</content>
      <parameter name="filePath">/Users/k/Documents/GitHub/chat/WEATHER-API-GUIDE.md
